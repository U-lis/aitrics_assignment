이 문서는 AI Agent 가 작업을 하면서 "반드시" 준수해야 하는 내용을 작성한 문서이다.

# 0. Global Rule

- 사용자의 질문이나 제안, 새로운 아이디어에 대해 사실확인이나 검증 없이 칭찬하거나 동조하지 않는다.
- 사용자에게 답변할 때는 근거를 같이 들어 설명한다.
- DDD 에 기반해 작업에 대해서 필요한 맥락이나 사전지식이 있다면 도메인 지식을 요청한다.
- 모든 설계와 작업은 오컴의 면도날 원칙에 따라 가장 작고 간단하게 요구사항을 해결하는 방향으로 진행한다.
    - YAGNI 원칙을 생각할 것.
    - 마세라티 문제를 만들지 말 것.
- 사용자와의 소통에는 한국어를 사용하고, 그 이외(작업 중 context 및 생각, changelog, commit message 등)에는 영어를 사용할 것.

# 1. 작업 계획

## 1.0. Ground Rule

- 모든 파일은 claude_works/ 아래에 작성한다. 앞으로 작업 계획 단락에 있는 모든 md file path는 별도의 지정이 없으면 claude_works/ 아래를 기본 path 로 생각한다.
- 모든 파일은 추후 다른 AI Agent가 읽고 작업을 수행하는 것을 전제로 작성한다. 다시 문서를 읽었을 때 context와 작업 목표, 방향성을 오해하지 않도록 명확한 문구로 작성한다.
- 모든 파일은 추후 다른 AI Agent 가 읽을 때 빠른 파악과 token 절약을 위해 English + AI Optimized prompt 로 작성한다.

## 1.1. 작업 계획 지시를 받았을 때

### 1.1.1. 새 기능 생성 시

- 해당 기능이 이미 구현되어 있는지 기존 코드를 확인한다.
- 프로젝트 구조 상 새 기능이 개발되어야 하는 가장 적합한 위치를 clean architecture 원칙을 기반으로 선정한다.

### 1.1.2. 기존 기능/버그 수정

- 해당 기능이 사용되는 곳을 전부 확인해 이 수정이 미칠 영향을 분석한다.
- 해당 기능을 사용하는 모든 테스트를 확인해 잠재적인 테스트 수정 범위를 분석한다.

### 1.1.3. 리팩토링/재구조화

- XP 전문가의 입장에서, 근거(현 상황, code smell, principle violation, solution)를 들어 수정 방향을 제시한다.

## 1.2. 작업 계획 파일 작성

### 1.2.0. Ground Rule

- 문서 작성 이후 codebase 가 변경될 수 있으니 수정된 코드를 작성하지 말고 어떤 클래스/함수의 어떤 잘못된 부분을 어떻게 수정하라는 지시사항만 작성.
    - 새 패턴 적용, 새 함수 생성 등 AI agent 가 맥락에서 추론할 수 없는 정보에 한해서만 수정/샘플 코드 작성 허가함.
- 여러 phase 가 서로 의존성 없이 독립적으로 동시에 개발될 수 있는 경우 phase number 에 A, B, C를 붙여 동시 작업 가능하다는 것을 표현한다.
    - 예를 들어 Phase 1 다음 Phase 2, 3, 4 가 동시에 진행될 수 있고, 2, 3, 4 가 다 완료된 후에 Phase 5 를 진행할 수 있다면 이는 1, 2A, 2B, 2C 3으로 정리한다.

### 1.2.1. 작업 계획이 2- phase로 크지 않을 때

- {subject_upper}.md 파일에 작업 계획을 작성한다.

### 1.2.2. 작업 계획이 3+ phase 로 나뉘어질 때

- {subject_lower}/GLOBAL.md 파일에 다음 내용을 작성한다.
    - 작업의 전체 목표
    - 모든 phase 작업 시 알아야 하는 context, 공통 지시사항/주의사항
    - 각 phase별 summary와 진행 상황
    - (optional) reference 문서 링크 등 참고자료
- {subject_lower}/PHASE_{K}_{phase_keyword_upper}.md 파일에 다음 내용을 작성한다.
    - 해당 phase 의 목표
    - 상세한 phase 작업 instruction.
    - 해당 phase 작업 시 특별히 유의할 점
    - phase 달성 여부를 판단할 수 있는 체크리스트
    - (새 기능 추가 시) 해당 기능을 테스트하기 위한 전체 테스트케이스 (목표 coverage: >= 75%)

# 2. 작업 진행

## 2.0. Ground Rule

- `git reset --HARD` 명령어는 어떤 경우에도 절대 사용하지 않는다.
- 작업 개시 지시를 받기 전에는 실제 코드 작업을 수행하지 않는다.
- 작업 시작 전 계획 중 불명확한 부분이나 선택/결정이 필요한 부분이 있다면 작업을 시작하지 말고 해당 부분을 보고해 사용자의 최종 확인을 먼저 받는다.
- 작업이 완료되면 summary 를 보고하고 사용자의 리뷰/추가 명령을 대기한다.
- 사용자 지시 없이 git add 또는 git commit 을 하지 않는다.
- 작업 중 파일, 클래스, 함수의 이동이 필요한 경우 재작성하지 않고 원븐을 그대로 이전한다. 가능한 경우 mv/cp command 등을 이용한다.
- Python code 작성 시 [claude_py.md](claude_works/claude_py.md) 파일에 있는 지시사항을 준수한다.
- 설정을 추가/수정해야 하는 경우 .env.example 에 해당 부분을 반영하고, work summary 에서 꼭 사용자에게 .env update 가 필요함을 알린다.
    - 만일 실제 설정 파일인 .env 에 추가/수정이 필요한 경우 절대로 직접 수정하지 말고 사용자에게 수정을 요청해야 한다.
    - .env 수정 없이 작업을 이어갈 수 없다면 수정을 요청하고 사용자의 작업 완료 + 진행 지시를 기다린다.

## 2.1. 사용자의 직접 명령으로 바로 작업할 때

### 2.1.0. Ground Rule

- 해당 작업 지시가 "새 기능 생성", "기능/버그 수정", "리팩토링/재구조화" 중 어떤 category 에 해당하는지 판단한 후 아래 지시사항을 준수한다.

### 2.1.1. 새 기능 생성

- 가장 먼저 해당 기능이 구현될 위치로 가장 적절한 곳을 clearn architecture 관점에서 파악한다.
    - god class 존재 등 전반전인 refactoring 이 필요한 경우 일단 현재 구조에서 가장 적합한 곳을 찾아 작업하고, 작업 완료 보고 시 refactoring signal 을 제시한다.
- 이미 구현된 중복 코드나 기존 코드 중 활용할 수 있는 것이 있는지 파악한다.
- 코드를 새로 작성하는 것이 유일한 옳은 방법인 경우 코드를 작성한다.

### 2.1.2. 기존 기능/버그 수정

- 사용자가 설명하는 문제가 어느 부분에서 발생하는지 원인이 되는 코드를 찾는다.
- 추후 해당 문제의 재발을 막을 수 있는 테스트를 추가해야 한다면 테스트 케이스도 작업 계획에 추가한다.
- 작업을 바로 시작하지 말고 원인과 해결책을 먼저 사용자에게 설명하고 지시를 기다린다.
- 코드 수정 완료 후 전체 test suite를 실행, 이번 코드 수정으로 인해 실패하는 테스트를 전부 수정한다.

### 2.1.3. 리팩토링/재구조화

- 작업 전 XP 전문가의 입장에서 해당 지시가 합당한 지시인지 1.1.3 에 해당하는 내용을 수행해 사용자에게 보고하고 지시를 기다린다.

## 2.2. claude_works/ 내의 작업 계획에 따라 작업할 때

### 2.2.0. Ground Rule

- Phase 별 md 파일에 있는 instruction 에 따라 작업 계획을 재점검한다. 현재 코드베이스가 문서 작성 시와 달라졌을 것에 대비해 상태 sync를 하고 업데이트가 필요한 계획이 있으면 업데이트해
  사용자에게 보고한다.
- phase 별 코드 작업이 완료되면 전체 test suite 를 수행해 작업으로 인해 깨진 테스트가 있다면 전부 고쳐질 때까지 수정한다. 만일 3번의 수정 시도에도 테스트가 실패한다면 이 테스트는 더 이상
  작업하지 말고 다음 사항으로 진행한 뒤, 작업 완료 보고시 특별사항으로 따로 보고한다.
- 한 번에는 한 phase 씩만 작업하며, 사용자 지시 없이 다음 phase 로 진행하지 않는다.
- 각 phase 진행 시 phase md file 을 지속적으로 확인하며, 해당 phase 에서 진행해야 하는 작업이 완료되었는지 checkbox 를 체크하며 진행한다.
- 사용자 지시 없이 GLOBAL md file 을 수정하지 않는다.

### 2.2.1. 새 기능 생성

- 모든 개발은 TDD 방식으로 진행한다. (테스트 > 기능 개발 > 작은 리팩토링 loop 반복)
- 기능 개발 중에는 새로 작성한 테스트만 수행해 빠른 개발을 도모한다.

### 2.2.2. 기존 기능/버그 수정

- 작업 전 작업 내용을 정리해 사용자에게 보고하고 지시를 기다린다.
- 사용자의 질문 시 DDD + XP 철학에 따라 검증하고 답변한다. 더 나은 방향이 있다면 제안한다.

### 2.2.3. 리팩토링/재구조화

- 현재 작업이 어떤 XP 원칙에 따른 작업인지 명확히 이해하고 해당 방향성에 집중한다.

# 3. 기타

## 3.1. CHANGELOG

### 3.1.1. 작업 순서

- changelog 는 새 버전 tagging 직전에 수행된다. 사용자의 지시를 받으면 다음을 준수한다.
- 최신 tag ~ HEAD까지의 commit 들을 확인해 merge, typo 등을 제외한 실제 의미있는 변경을 추린다.
- 작업 성격에 따라 [Keep a Changelog](https://keepachangelog.com) 형식에 맞게 분류한다.
- CHANGELOG.md 파일에 작성한다.

### 3.1.2. 작성 규칙

- 버전은 semver 에 따라 X.Y.Z 형태로 작성.
    - 새로 tagging 할 버전을 알 수 없는 경우 "X.Y.Z" 로 써놓고 사용자에게 해당 부분 수정 요청.
- 각 버전은 개별 항목으로 작성 (그룹화 금지)
- 날짜는 태그 생성일 기준 YYYY-MM-DD 형식
- 내용은 영문으로 작성.
- 최신버전이 파일 상단에 오도록 작성.
